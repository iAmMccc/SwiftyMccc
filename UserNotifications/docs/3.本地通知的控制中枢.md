# æœ¬åœ°é€šçŸ¥çš„æ§åˆ¶ä¸­æ¢ â€” æŒæ§è°ƒåº¦ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„å…³é”®

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»å¼€å‘è€…è§†è§’ï¼Œæ·±å…¥è§£æ iOS æœ¬åœ°é€šçŸ¥ç³»ç»Ÿçš„è°ƒåº¦æœºåˆ¶ã€ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ä»¥åŠå®é™…ä½¿ç”¨ä¸­çš„ç®¡ç†æŠ€å·§ï¼Œå¸®åŠ©ä½ æ„å»ºç¨³å®šå¯é çš„é€šçŸ¥ä½“ç³»ï¼Œé¿å…é‚£äº›â€œé€šçŸ¥æ·»åŠ æˆåŠŸå´æ‚„æ— å£°æ¯â€çš„å°´å°¬ã€‚



## ä¸€ã€ç³»ç»Ÿæœºåˆ¶æ­ç§˜ï¼šæ·»åŠ ä¸ç­‰äºå¼¹å‡º

å¾ˆå¤šå¼€å‘è€…åœ¨ä½¿ç”¨ `UNUserNotificationCenter` æ·»åŠ é€šçŸ¥è¯·æ±‚æ—¶ï¼Œå¸¸å¸¸ä¼šé‡åˆ°è¿™æ ·çš„ç–‘é—®ï¼š

> æˆ‘è°ƒç”¨äº†æ·»åŠ é€šçŸ¥çš„æ¥å£ï¼Œæ§åˆ¶å°æç¤ºâ€œé€šçŸ¥å·²æ·»åŠ â€ï¼Œä½†é€šçŸ¥è¿Ÿè¿Ÿæ²¡æœ‰å¼¹å‡ºï¼Ÿ

```
let center = UNUserNotificationCenter.current()

// 1. é€šçŸ¥å†…å®¹
let content = UNMutableNotificationContent()
content.title = "ğŸ“Œ æ¯æ—¥ä¸€å¥"
content.body = "æ¯ä¸€ä¸ªä¸æ›¾èµ·èˆçš„æ—¥å­ï¼Œéƒ½æ˜¯å¯¹ç”Ÿå‘½çš„è¾œè´Ÿ"
content.sound = .defaultCritical
content.categoryIdentifier = "DAILY_QUOTES"

// 2. é€šçŸ¥è§¦å‘å™¨ï¼ˆ10ç§’åï¼‰
let trigger = UNTimeIntervalNotificationTrigger(timeInterval: 10, repeats: false)

// 3. é€šçŸ¥è¯·æ±‚
let request = UNNotificationRequest(identifier: "quote_001", content: content, trigger: trigger)

// 4. æ·»åŠ é€šçŸ¥
center.add(request) { error in
    if let error = error {
        print("âŒ æ·»åŠ å¤±è´¥ï¼š\(error)")
    } else {
        print("âœ… é€šçŸ¥å·²æ·»åŠ ")
    }
}
```

å¾€å¾€çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºï¼š

```
âœ… é€šçŸ¥å·²æ·»åŠ 
```

ä½†åç§’è¿‡å»äº†ï¼Œé€šçŸ¥å´æ²¡æœ‰å‡ºç°ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ

è¿™æ˜¯ iOS é€šçŸ¥ç³»ç»Ÿè®¾è®¡ä¸­çš„æ ¸å¿ƒç†å¿µâ€”â€”**æ·»åŠ é€šçŸ¥ â‰  æ˜¾ç¤ºé€šçŸ¥**ã€‚

### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

- `add(request)` åªæ˜¯æŠŠé€šçŸ¥è¯·æ±‚äº¤ç»™ç³»ç»Ÿæ¥å—ï¼Œ**å¹¶ä¸ä¿è¯ä¸€å®šä¼šå±•ç¤º**
- é€šçŸ¥æ˜¯å¦å±•ç¤ºï¼Œä¾èµ–äºç”¨æˆ·æ˜¯å¦æˆæƒï¼Œä»¥åŠç³»ç»Ÿçš„è°ƒåº¦å†³ç­–
- æœªæˆæƒæ—¶ï¼Œç³»ç»Ÿä¼šé»˜é»˜ä¸¢å¼ƒè¯¥é€šçŸ¥è¯·æ±‚ï¼Œä¸”ä¸ä¼šå›è°ƒé”™è¯¯

### Apple çš„è®¾è®¡è€ƒé‡

1. **æƒé™ä¸é€šçŸ¥è°ƒåº¦è§£è€¦**
   å…è®¸å¼€å‘è€…é¢„å…ˆå®‰æ’é€šçŸ¥ï¼Œç³»ç»Ÿå†åŸºäºæˆæƒçŠ¶æ€å†³å®šå±•ç¤ºï¼Œæé«˜çµæ´»æ€§ã€‚
2. **é¿å…å¼‚å¸¸å¤æ‚åŒ–**
   æ·»åŠ é€šçŸ¥ä¸ä¼šå› æƒé™é—®é¢˜æŠ›å¼‚å¸¸ï¼Œç®€åŒ–å¼€å‘æµç¨‹ã€‚
3. **éšç§ä¿æŠ¤**
   æˆæƒçŠ¶æ€åªèƒ½é€šè¿‡å®˜æ–¹æ¥å£æŸ¥è¯¢ï¼Œé¿å…æˆæƒçŠ¶æ€è¢«è¯•æ¢ã€‚

#### é‡è¦æé†’

- **æˆæƒåï¼Œä¹‹å‰æœªæˆæƒæ—¶æ·»åŠ çš„é€šçŸ¥ä¸ä¼šè‡ªåŠ¨è¡¥å‘ï¼**
- å¼€å‘è€…éœ€åœ¨æ·»åŠ é€šçŸ¥å‰ä¸»åŠ¨æ£€æµ‹æˆæƒçŠ¶æ€ï¼Œé¿å…æ·»åŠ â€œæ— æ•ˆâ€é€šçŸ¥ã€‚

```
UNUserNotificationCenter.current().getNotificationSettings { settings in
    guard settings.authorizationStatus == .authorized else {
        print("æœªæˆæƒé€šçŸ¥ï¼Œä¸å‘é€")
        return
    }
    UNUserNotificationCenter.current().add(request)
}
```



## äºŒã€é€šçŸ¥çš„å¤§è„‘ä¸­æ¢

`UNUserNotificationCenter` æ˜¯ iOS ä¸­è´Ÿè´£**æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹é€šçŸ¥è°ƒåº¦**çš„ç»Ÿä¸€æ¥å£ï¼Œæä¾›äº†æƒé™ç”³è¯·ã€æ·»åŠ é€šçŸ¥ã€ç®¡ç†é€šçŸ¥ã€æŸ¥è¯¢çŠ¶æ€ç­‰ä¸€ç³»åˆ—èƒ½åŠ›ã€‚

```
let center = UNUserNotificationCenter.current()
```

### 1. ç”³è¯·é€šçŸ¥æƒé™

```
center.requestAuthorization(options: [.alert, .sound, .badge]) { granted, error in
    print("æˆæƒç»“æœï¼š\(granted)")
}
```

### 2. æŸ¥è¯¢å½“å‰æˆæƒçŠ¶æ€

```
center.getNotificationSettings { settings in
    print(settings.authorizationStatus)
}
```

## ä¸‰ã€é€šçŸ¥çš„æ·»åŠ ä¸åˆ†ç±»ç®¡ç†

### 1. æ·»åŠ é€šçŸ¥è¯·æ±‚

```
let request = UNNotificationRequest(identifier: "id_001", content: content, trigger: trigger)
center.add(request)
```

### 2. åˆ†ç±»æ³¨å†Œï¼ˆæ”¯æŒäº¤äº’ã€æŒ‰é’®ç­‰ï¼‰

```
let category = UNNotificationCategory(identifier: "DAILY_QUOTES", actions: [...], intentIdentifiers: [])
center.setNotificationCategories([category])
```



## å››ã€é€šçŸ¥çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 1. æŸ¥è¯¢å¾…å‘é€šçŸ¥

```
center.getPendingNotificationRequests { requests in
    print("å½“å‰å¾…å‘é€šçŸ¥æ•°é‡ï¼š\(requests.count)")
}
```

### 2. åˆ é™¤å¾…å‘é€šçŸ¥

```
// æŒ‰æ ‡è¯†åˆ é™¤
center.removePendingNotificationRequests(withIdentifiers: ["task_id"])
// å…¨éƒ¨æ¸…é™¤
center.removeAllPendingNotificationRequests()
```

### 3. æŸ¥è¯¢å·²å‘é€šçŸ¥

é€šçŸ¥ä¸­å¿ƒä¸­å·²å±•ç¤ºçš„

```
center.getDeliveredNotifications { notifications in
    print("å·²å‘é€šçŸ¥æ•°é‡ï¼š\(notifications.count)")
}
```

### 4. åˆ é™¤å·²å‘é€šçŸ¥

```
center.removeDeliveredNotifications(withIdentifiers: ["id_001"])
center.removeAllDeliveredNotifications()
```



## äº”ã€é€šè¿‡ä¸‰ä¸ªidentifierç®¡ç†é€šçŸ¥

åœ¨ iOS é€šçŸ¥ç³»ç»Ÿä¸­ï¼Œ`UNUserNotificationCenter` é€šè¿‡å¤šä¸ªæ ‡è¯†ç¬¦ç®¡ç†é€šçŸ¥çš„å±•ç¤ºå’Œç”Ÿå‘½å‘¨æœŸï¼Œåˆ†åˆ«è´Ÿè´£ä¸åŒç»´åº¦çš„æ§åˆ¶ï¼š

### ä¸»è¦æ ‡è¯†ç¬¦åŠå…¶èŒè´£

| æ ‡è¯†ç¬¦                       | æ‰€å±å¯¹è±¡                       | ä½œç”¨è¯´æ˜                                                     | ä¸¾ä¾‹                                       |
| ---------------------------- | ------------------------------ | ------------------------------------------------------------ | ------------------------------------------ |
| `request.identifier`         | `UNNotificationRequest`        | é€šçŸ¥è¯·æ±‚çš„å”¯ä¸€ IDï¼Œæ§åˆ¶é€šçŸ¥çš„æ·»åŠ ã€æ›¿æ¢ä¸ç§»é™¤ã€‚æ˜¯é€šçŸ¥çš„â€œèº«ä»½è¯â€ã€‚ | æ›¿æ¢â€œæ¯æ—¥æé†’â€é€šçŸ¥ï¼Œé˜²æ­¢é‡å¤æé†’           |
| `content.categoryIdentifier` | `UNMutableNotificationContent` | ç”¨äºç»‘å®šé€šçŸ¥ç±»åˆ«ï¼Œå…³è”äº¤äº’åŠ¨ä½œï¼ˆæŒ‰é’®ã€å›å¤ç­‰ï¼‰ï¼Œå®šä¹‰é€šçŸ¥è¡Œä¸ºã€‚ | ç»‘å®šâ€œèŠå¤©æ¶ˆæ¯â€ç±»åˆ«ï¼Œæ˜¾ç¤ºâ€œå›å¤â€æŒ‰é’®         |
| `content.threadIdentifier`   | `UNMutableNotificationContent` | ç”¨äºé€šçŸ¥åˆ†ç»„ï¼Œå°†å¤šä¸ªç›¸å…³é€šçŸ¥å½’ç±»åœ¨ä¸€èµ·ï¼Œæå‡é€šçŸ¥ä¸­å¿ƒçš„æ•´æ´åº¦ã€‚ | å°†åŒä¸€ä¸ªèŠå¤©ç¾¤çš„å¤šæ¡æ¶ˆæ¯é€šçŸ¥èšåˆä¸ºä¸€ç»„æ˜¾ç¤º |

#### 1. `request.identifier` â€” é€šçŸ¥çš„å”¯ä¸€èº«ä»½è¯ï¼Œæ§åˆ¶æ·»åŠ ä¸æ›¿æ¢

**ä½œç”¨ï¼š**
æ¯ä¸ª `UNNotificationRequest` éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„ `identifier`ï¼Œç³»ç»Ÿé€šè¿‡å®ƒæ¥è¯†åˆ«é€šçŸ¥ã€‚æ·»åŠ ç›¸åŒ `identifier`çš„è¯·æ±‚ï¼Œä¼šæ›¿æ¢ä¹‹å‰çš„é€šçŸ¥ï¼Œé˜²æ­¢é‡å¤æé†’ã€‚

**ä¸¾ä¾‹ï¼š**

å‡è®¾ä½ åšä¸€ä¸ªæ¯æ—¥æé†’ Appï¼Œæ¯å¤©æ—©ä¸Š 8 ç‚¹å‘é€ä¸€æ¡æé†’ï¼š

```
let content = UNMutableNotificationContent()
content.title = "æ¯æ—¥æé†’"
content.body = "æ–°çš„ä¸€å¤©ï¼Œå¼€å§‹åŠªåŠ›å§ï¼"
content.sound = .default

let trigger = UNCalendarNotificationTrigger(dateMatching: dateComponents, repeats: true)
let request = UNNotificationRequest(identifier: "daily_reminder", content: content, trigger: trigger)
UNUserNotificationCenter.current().add(request)
```

- å¦‚æœä½ å†æ¬¡æ·»åŠ  `identifier` ä¸º `"daily_reminder"` çš„é€šçŸ¥ï¼Œç³»ç»Ÿä¼š**è¦†ç›–ä¹‹å‰çš„é‚£æ¡**ï¼Œé¿å…æ¯å¤©æ”¶åˆ°é‡å¤çš„å¤šæ¡æé†’ã€‚
- å¦‚æœæƒ³å–æ¶ˆè¿™æ¡é€šçŸ¥ï¼Œåªéœ€è°ƒç”¨ `removePendingNotificationRequests(withIdentifiers: ["daily_reminder"])`ã€‚



#### 2. `content.categoryIdentifier` â€” ç»‘å®šé€šçŸ¥ç±»åˆ«ï¼Œå®šä¹‰äº¤äº’è¡Œä¸º

**ä½œç”¨ï¼š**
`categoryIdentifier` å…³è”åˆ° `UNNotificationCategory`ï¼Œå®šä¹‰é€šçŸ¥å¯ä»¥åŒ…å«å“ªäº›äº¤äº’æŒ‰é’®å’Œæ“ä½œï¼Œä¾‹å¦‚å›å¤ã€æ ‡è®°å®Œæˆã€åˆ é™¤ç­‰ã€‚

**ä¸¾ä¾‹ï¼š**

ä½ åšä¸€ä¸ªèŠå¤© Appï¼Œé€šçŸ¥é‡Œå¸¦â€œå›å¤â€æŒ‰é’®ï¼š

```
// 1. æ³¨å†Œç±»åˆ«
let replyAction = UNTextInputNotificationAction(
    identifier: "REPLY_ACTION",
    title: "å›å¤",
    options: [])

let category = UNNotificationCategory(
    identifier: "MESSAGE_CATEGORY",
    actions: [replyAction],
    intentIdentifiers: [],
    options: [])

UNUserNotificationCenter.current().setNotificationCategories([category])

// 2. å‘é€é€šçŸ¥æ—¶ç»‘å®šç±»åˆ«
let content = UNMutableNotificationContent()
content.title = "æ–°æ¶ˆæ¯"
content.body = "ä½ æ”¶åˆ°ä¸€æ¡å¥½å‹æ¶ˆæ¯"
content.sound = .default
content.categoryIdentifier = "MESSAGE_CATEGORY"
```

- ç”¨æˆ·æ”¶åˆ°é€šçŸ¥æ—¶ï¼Œå¯ä»¥ç›´æ¥åœ¨é€šçŸ¥ä¸­å¿ƒç‚¹å‡»â€œå›å¤â€æŒ‰é’®ï¼Œå¿«é€Ÿå›å¤æ¶ˆæ¯ã€‚
- å¦‚æœé€šçŸ¥æ²¡æœ‰ç»‘å®šç±»åˆ«ï¼Œåˆ™é»˜è®¤ä¸æ˜¾ç¤ºäº¤äº’æŒ‰é’®ã€‚



#### 3. `content.threadIdentifier` â€” ç›¸å…³é€šçŸ¥åˆ†ç»„ï¼Œä¼˜åŒ–é€šçŸ¥ä¸­å¿ƒå±•ç¤º

**ä½œç”¨ï¼š**
ç³»ç»Ÿæ ¹æ® `threadIdentifier` æŠŠå±äºåŒä¸€ç»„çš„é€šçŸ¥æŠ˜å æ˜¾ç¤ºï¼Œå‡å°‘é€šçŸ¥ä¸­å¿ƒæ‚ä¹±æ„Ÿã€‚

**ä¸¾ä¾‹ï¼š**

å‡è®¾ä½ æ˜¯ä¸€ä¸ªç¤¾äº¤ Appï¼Œæœ‰å¤šä¸ªèŠå¤©ç¾¤ï¼Œé€šçŸ¥ä¸­å¿ƒå¸Œæœ›æŠŠåŒä¸€ä¸ªç¾¤çš„æ¶ˆæ¯é€šçŸ¥åˆ†ä¸ºä¸€ç»„ï¼š

```
let content = UNMutableNotificationContent()
content.title = "èŠå¤©ç¾¤ï¼šSwifté«˜æ‰‹"
content.body = "æœ‰äººå‘äº†ä¸€æ¡æ–°æ¶ˆæ¯"
content.sound = .default
content.threadIdentifier = "chat_group_swift"  // æŠŠè¯¥ç¾¤æ¶ˆæ¯é€šçŸ¥èšåˆ
```

- å¦‚æœæ¥æ”¶äº†å¤šæ¡ `threadIdentifier` ç›¸åŒçš„é€šçŸ¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†å®ƒä»¬æŠ˜å æ˜¾ç¤ºæˆä¸€ä¸ªé€šçŸ¥ç»„ã€‚
- ç”¨æˆ·ç‚¹å‡»åå¯ä»¥å±•å¼€æŸ¥çœ‹æ‰€æœ‰åŒç»„é€šçŸ¥ï¼Œä½“éªŒæ›´æ¸…çˆ½ã€‚



## å…­ã€å¿½è§†é€šçŸ¥ç®¡ç†çš„åæœ

å¦‚æœå¯¹é€šçŸ¥æ ‡è¯†ç¬¦å’Œç®¡ç†æœºåˆ¶ä¸ç†è§£ï¼Œå®¹æ˜“å¯¼è‡´ï¼š

- ç”¨æˆ·æ”¶åˆ°å¤§é‡é‡å¤æˆ–å†—ä½™çš„æé†’ï¼Œä½“éªŒå˜å·®
- å¤šæ¬¡æ·»åŠ åŒç±»é€šçŸ¥ï¼Œå¼¹çª—é‡å¤å¹²æ‰°ç”¨æˆ·
- å·²å±•ç¤ºçš„é€šçŸ¥æœªè¢«åŠæ—¶æ¸…ç†ï¼Œé€šçŸ¥ä¸­å¿ƒå †ç§¯æ‚ä¹±
- åº”ç”¨é‡å¯åæ—§é€šçŸ¥ä¾ç„¶å­˜åœ¨ï¼Œä¸šåŠ¡é€»è¾‘å¯èƒ½å¤±æ•ˆ



### å®ç”¨ç®¡ç†æŠ€å·§

#### 1. é¿å…é‡å¤é€šçŸ¥ï¼šåˆ©ç”¨ç›¸åŒè¯·æ±‚æ ‡è¯†ç¬¦è¦†ç›–æ—§é€šçŸ¥

```
let request = UNNotificationRequest(identifier: "daily_reminder", content: content, trigger: trigger)
center.add(request)  // ä¼šæ›¿æ¢å·²å­˜åœ¨çš„ "daily_reminder"
```

ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ« `identifier`ï¼Œç”¨æœ€æ–°è¯·æ±‚è¦†ç›–æ—§è¯·æ±‚ï¼Œé¿å…é‡å¤æé†’ã€‚

#### 2. å…ˆç§»é™¤å†æ·»åŠ ï¼šå¤šå…¥å£è°ƒç”¨æ—¶ä¿è¯çŠ¶æ€ä¸€è‡´

```
center.removePendingNotificationRequests(withIdentifiers: ["task_reminder"])
center.add(request)
```

å…ˆç§»é™¤å¾…å‘é€šçŸ¥ï¼Œé˜²æ­¢ä¸åŒä»£ç è·¯å¾„æ·»åŠ é‡å¤é€šçŸ¥å¯¼è‡´çš„æ··ä¹±ã€‚





## ä¸‹ä¸€ç« é¢„å‘Šï¼šæŒæ§é€šçŸ¥è§¦å‘çš„ä¸‰æŠŠé’¥åŒ™

äº†è§£äº†é€šçŸ¥ç³»ç»Ÿçš„æ•´ä½“ç»“æ„åï¼Œä½ å¯èƒ½ä¼šå¥½å¥‡ï¼š
**é€šçŸ¥ç©¶ç«Ÿæ˜¯â€œä»€ä¹ˆæ—¶å€™â€ã€â€œä»€ä¹ˆåœ°ç‚¹â€ä»¥åŠâ€œä»€ä¹ˆæ¡ä»¶ä¸‹â€è§¦å‘çš„ï¼Ÿ**

åœ¨ä¸‹ä¸€ç« ã€Šæœ¬åœ°é€šçŸ¥çš„ç²¾å‡†æ§åˆ¶ä¸‰è§’ã€‹ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥å‰–æé€šçŸ¥çš„ä¸‰å¤§è§¦å‘æœºåˆ¶ï¼š

- â° **æ—¶é—´è§¦å‘**ï¼šè®¾å®šæ—¥ç¨‹ã€å®šæ—¶æé†’ã€é—¹é’Ÿæœºåˆ¶
- ğŸ“ **ä½ç½®è§¦å‘**ï¼šåˆ°åº—æ‰“å¡ã€åˆ°è¾¾åå¼•å¯¼ã€åœ°ç†å›´æ 
- ğŸ§  **æƒ…å¢ƒè§¦å‘**ï¼šä»»åŠ¡å®Œæˆåå‘å‡ºæé†’ã€åå°æ™ºèƒ½è°ƒåº¦

è¿™ä¸€ç« å°†ä»å®æˆ˜è§’åº¦å‡ºå‘ï¼Œå¸®ä½ æ„å»ºä¸€ä¸ª**â€œå¦‚çº¦è€Œè‡³â€çš„é€šçŸ¥ç³»ç»Ÿ**ï¼šä¸ä»…èƒ½å‡†æ—¶é€è¾¾ï¼Œè¿˜èƒ½æ°åˆ°å¥½å¤„åœ°å¥‘åˆç”¨æˆ·è¡Œä¸ºä¸ç¯å¢ƒã€‚

