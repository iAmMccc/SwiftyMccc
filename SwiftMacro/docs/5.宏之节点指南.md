# Swift Macros - SwiftSyntax èŠ‚ç‚¹æŒ‡å—

> ç‰ˆæœ¬ï¼š2025.04.27ï½œç»´æŠ¤è€…ï¼š[Mccc](https://github.com/iAmMccc)ï½œæ¬¢è¿å…±åŒç»´æŠ¤ä¸è¡¥å……ï¼

åœ¨ç¼–å†™ Swift å®æ—¶ï¼Œä½ å°†é¢‘ç¹ä¸ `SwiftSyntax` æ‰“äº¤é“ã€‚SwiftSyntax å°†æºç æ‹†è§£ä¸ºç»“æ„åŒ–çš„**è¯­æ³•èŠ‚ç‚¹ï¼ˆSyntaxï¼‰æ ‘**ï¼Œè¿™äº›èŠ‚ç‚¹è¦†ç›–äº†è¡¨è¾¾å¼ã€å£°æ˜ã€è¯­å¥ã€ç±»å‹ã€æ¨¡å¼ã€å±æ€§ç­‰å„ä¸ªå±‚é¢ã€‚

æœ¬ç¯‡æ–‡ç« æä¾›ä¸€ä¸ªå®ç”¨é€ŸæŸ¥è¡¨ï¼Œå¸®åŠ©ä½ å¿«é€Ÿäº†è§£å„ç±»å¸¸è§è¯­æ³•èŠ‚ç‚¹çš„ç”¨é€”ä¸æ„é€ æ–¹æ³•ï¼Œä¾¿äºé«˜æ•ˆæ„å»ºå®æ‰€éœ€çš„ä»£ç ç»“æ„ã€‚



# ç›®å½•

- [1. è¡¨è¾¾å¼ï¼ˆExprSyntaxï¼‰](#1-è¡¨è¾¾å¼exprsyntax)
- [2. å£°æ˜ï¼ˆDeclSyntaxï¼‰](#2-å£°æ˜declsyntax)
- [3. è¯­å¥ï¼ˆStmtSyntaxï¼‰](#3-è¯­å¥stmtsyntax)
- [4. ç±»å‹ï¼ˆTypeSyntaxï¼‰](#4-ç±»å‹typesyntax)
- [5. æ¨¡å¼ï¼ˆPatternSyntaxï¼‰](#5-æ¨¡å¼patternsyntax)
- [6. å±æ€§ï¼ˆAttributeSyntaxï¼‰](#6-å±æ€§attributesyntax)
- [7. å®ï¼ˆMacroExpansionSyntaxï¼‰](#7-å®macroexpansionsyntax)
- [8. å…¶ä»–å¸¸ç”¨èŠ‚ç‚¹](#8-å…¶ä»–å¸¸ç”¨èŠ‚ç‚¹)

---

## 1. è¡¨è¾¾å¼ï¼ˆExprSyntaxï¼‰

è¿™é‡Œæ˜¯è¡¨è¾¾å¼èŠ‚ç‚¹çš„è¯¦ç»†è¯´æ˜â€¦â€¦

## 2. å£°æ˜ï¼ˆDeclSyntaxï¼‰

è¿™é‡Œæ˜¯å£°æ˜èŠ‚ç‚¹çš„è¯¦ç»†è¯´æ˜â€¦â€¦

## 3. è¯­å¥ï¼ˆStmtSyntaxï¼‰

è¿™é‡Œæ˜¯è¯­å¥èŠ‚ç‚¹çš„è¯¦ç»†è¯´æ˜â€¦â€¦

## 4. ç±»å‹ï¼ˆTypeSyntaxï¼‰

è¿™é‡Œæ˜¯ç±»å‹èŠ‚ç‚¹çš„è¯¦ç»†è¯´æ˜â€¦â€¦

## 5. æ¨¡å¼ï¼ˆPatternSyntaxï¼‰

è¿™é‡Œæ˜¯æ¨¡å¼èŠ‚ç‚¹çš„è¯¦ç»†è¯´æ˜â€¦â€¦

## 6. å±æ€§ï¼ˆAttributeSyntaxï¼‰

è¿™é‡Œæ˜¯å±æ€§èŠ‚ç‚¹çš„è¯¦ç»†è¯´æ˜â€¦â€¦

## 7. å®ï¼ˆMacroExpansionSyntaxï¼‰

è¿™é‡Œæ˜¯å®èŠ‚ç‚¹çš„è¯¦ç»†è¯´æ˜â€¦â€¦

## 8. å…¶ä»–å¸¸ç”¨èŠ‚ç‚¹

è¿™é‡Œæ˜¯å…¶ä»–å¸¸ç”¨èŠ‚ç‚¹çš„è¯¦ç»†è¯´æ˜â€¦â€¦





## ç›®å½•

[1. è¡¨è¾¾å¼ï¼ˆExprSyntaxï¼‰](#1-è¡¨è¾¾å¼exprsyntax)

[2. å£°æ˜ï¼ˆDeclSyntaxï¼‰](#2-å£°æ˜declsyntax)

[3. è¯­å¥ï¼ˆStmtSyntaxï¼‰](#3-è¯­å¥stmtsyntax)

[4. ç±»å‹ï¼ˆTypeSyntaxï¼‰](#4-ç±»å‹typesyntax)

[5. æ¨¡å¼ï¼ˆPatternSyntaxï¼‰](#5-æ¨¡å¼patternsyntax)

[6. å±æ€§ï¼ˆAttributeSyntaxï¼‰](#6-å±æ€§attributesyntax)

[7. å®ï¼ˆMacroExpansionSyntaxï¼‰](#7-å®macroexpansionsyntax)

[8. å…¶ä»–å¸¸ç”¨èŠ‚ç‚¹](#8-å…¶ä»–å¸¸ç”¨èŠ‚ç‚¹)

ç”¨äºè¡¨ç¤ºå„ç§è®¡ç®—è¡¨è¾¾å¼ã€å‡½æ•°è°ƒç”¨ã€å­—é¢é‡ç­‰ï¼Œæ˜¯æœ€å¸¸è§çš„è¯­æ³•ç»“æ„ä¹‹ä¸€ã€‚

| åç§°                          | æè¿°                      | å¿«é€Ÿæ„é€ ç¤ºä¾‹                                                 |
| ----------------------------- | ------------------------- | ------------------------------------------------------------ |
| **ArrayExprSyntax**           | æ•°ç»„è¡¨è¾¾å¼ `[a, b, c]`    | `ArrayExprSyntax(elements: [...])`                           |
| **BooleanLiteralExprSyntax**  | å¸ƒå°”å­—é¢é‡ `true / false` | `BooleanLiteralExprSyntax(value: true)`                      |
| **IntegerLiteralExprSyntax**  | æ•´æ•°å­—é¢é‡ `123`          | `IntegerLiteralExprSyntax(literal: "123")`                   |
| **FloatLiteralExprSyntax**    | æµ®ç‚¹å­—é¢é‡ `1.23`         | `FloatLiteralExprSyntax(floatingDigits: "1.23")`             |
| **StringLiteralExprSyntax**   | å­—ç¬¦ä¸² `"abc"`            | `StringLiteralExprSyntax(content: "abc")`                    |
| **IdentifierExprSyntax**      | æ ‡è¯†ç¬¦ `foo`              | `IdentifierExprSyntax(identifier: .identifier("foo"))`       |
| **FunctionCallExprSyntax**    | å‡½æ•°è°ƒç”¨ `foo(a, b)`      | `FunctionCallExprSyntax(calledExpression: ..., arguments: [...])` |
| **MemberAccessExprSyntax**    | æˆå‘˜è®¿é—® `a.b`            | `MemberAccessExprSyntax(base: ..., name: .identifier("b"))`  |
| **PrefixOperatorExprSyntax**  | å‰ç¼€æ“ä½œ `-a`             | `PrefixOperatorExprSyntax(operator: "-", expression: ...)`   |
| **PostfixOperatorExprSyntax** | åç¼€æ“ä½œ `a!`             | `PostfixOperatorExprSyntax(expression: ...)`                 |
| **NilLiteralExprSyntax**      | ç©ºå€¼ `nil`                | `NilLiteralExprSyntax()`                                     |
| **ClosureExprSyntax**         | é—­åŒ… `{ a in a + 1 }`     | `ClosureExprSyntax(parameters: ..., statements: [...])`      |
| **TupleExprSyntax**           | å…ƒç»„ `(a, b)`             | `TupleExprSyntax(elements: [...])`                           |
| **TryExprSyntax**             | `try` è¡¨è¾¾å¼              | `TryExprSyntax(expression: ...)`                             |
| **AwaitExprSyntax**           | `await` è¡¨è¾¾å¼            | `AwaitExprSyntax(expression: ...)`                           |
| **AsExprSyntax**              | ç±»å‹è½¬æ¢ `as`             | `AsExprSyntax(expression: ..., type: ...)`                   |
| **IsExprSyntax**              | ç±»å‹æ£€æŸ¥ `is`             | `IsExprSyntax(expression: ..., type: ...)`                   |
| **TernaryExprSyntax**         | ä¸‰ç›®è¡¨è¾¾å¼ `a ? b : c`    | `TernaryExprSyntax(condition: ..., thenExpr: ..., elseExpr: ...)` |
| **SequenceExprSyntax**        | è¡¨è¾¾å¼åºåˆ— `1 + 2 * 3`    | `SequenceExprSyntax(elements: [...])`                        |

> ğŸ’¡ **æŠ€å·§ï¼š** ä¸­ç¼€è¡¨è¾¾å¼ï¼ˆå¦‚ `+`, `-`, `*`ï¼‰ç»Ÿä¸€ç”± `SequenceExprSyntax` è¡¨ç¤ºï¼Œä¸å†æœ‰ BinaryExprã€‚



## 2. å£°æ˜ï¼ˆDeclSyntaxï¼‰

è¡¨ç¤ºå˜é‡ã€å‡½æ•°ã€ç±»å‹ã€åè®®ç­‰çš„å®šä¹‰ï¼Œæ˜¯æ„å»ºå®æ—¶ç”Ÿæˆç»“æ„ä»£ç çš„æ ¸å¿ƒç»„æˆã€‚

| åç§°                         | æè¿°             | å¿«é€Ÿæ„é€ ç¤ºä¾‹                                                 |
| ---------------------------- | ---------------- | ------------------------------------------------------------ |
| **VariableDeclSyntax**       | å˜é‡ `let/var`   | `VariableDeclSyntax(bindingSpecifier: "let", bindings: [...])` |
| **FunctionDeclSyntax**       | å‡½æ•°             | `FunctionDeclSyntax(name: "foo", signature: ..., body: ...)` |
| **StructDeclSyntax**         | ç»“æ„ä½“           | `StructDeclSyntax(identifier: "Foo", memberBlock: ...)`      |
| **ClassDeclSyntax**          | ç±»               | `ClassDeclSyntax(identifier: "Foo", memberBlock: ...)`       |
| **EnumDeclSyntax**           | æšä¸¾             | `EnumDeclSyntax(identifier: "Foo", memberBlock: ...)`        |
| **ExtensionDeclSyntax**      | æ‰©å±•             | `ExtensionDeclSyntax(extendedType: ..., memberBlock: ...)`   |
| **ProtocolDeclSyntax**       | åè®®             | `ProtocolDeclSyntax(identifier: "Foo", memberBlock: ...)`    |
| **ImportDeclSyntax**         | å¯¼å…¥æ¨¡å—         | `ImportDeclSyntax(path: ["Foundation"])`                     |
| **TypeAliasDeclSyntax**      | ç±»å‹åˆ«å         | `TypeAliasDeclSyntax(identifier: "Alias", type: ...)`        |
| **AssociatedTypeDeclSyntax** | åè®®ä¸­å…³è”ç±»å‹   | `AssociatedTypeDeclSyntax(identifier: "T")`                  |
| **MacroDeclSyntax**          | å®å£°æ˜           | `MacroDeclSyntax(identifier: "MyMacro")`                     |
| **OperatorDeclSyntax**       | è‡ªå®šä¹‰æ“ä½œç¬¦å£°æ˜ | `OperatorDeclSyntax(operatorKeyword: "operator", name: "+")` |



## 3. è¯­å¥ï¼ˆStmtSyntaxï¼‰

ç”¨äºæ„å»ºæ§åˆ¶æµç¨‹è¯­å¥ï¼ˆifã€guardã€switch ç­‰ï¼‰å’Œå‡½æ•°ä½“å†…é€»è¾‘ç»“æ„ã€‚

| åç§°                      | æè¿°              | å¿«é€Ÿæ„é€ ç¤ºä¾‹                                          |
| ------------------------- | ----------------- | ----------------------------------------------------- |
| **IfStmtSyntax**          | if è¯­å¥           | `IfStmtSyntax(conditions: [...], body: ...)`          |
| **GuardStmtSyntax**       | guard è¯­å¥        | `GuardStmtSyntax(conditions: [...], body: ...)`       |
| **WhileStmtSyntax**       | while å¾ªç¯        | `WhileStmtSyntax(conditions: [...], body: ...)`       |
| **RepeatWhileStmtSyntax** | repeat-while å¾ªç¯ | `RepeatWhileStmtSyntax(body: ..., condition: ...)`    |
| **ForStmtSyntax**         | for-in å¾ªç¯       | `ForStmtSyntax(pattern: ..., inExpr: ..., body: ...)` |
| **SwitchStmtSyntax**      | switch åˆ†æ”¯       | `SwitchStmtSyntax(expression: ..., cases: [...])`     |
| **ReturnStmtSyntax**      | return è¿”å›       | `ReturnStmtSyntax(expression: ...)`                   |
| **ThrowStmtSyntax**       | æŠ›å‡ºå¼‚å¸¸          | `ThrowStmtSyntax(expression: ...)`                    |
| **BreakStmtSyntax**       | break è·³å‡º        | `BreakStmtSyntax()`                                   |
| **ContinueStmtSyntax**    | continue ç»§ç»­     | `ContinueStmtSyntax()`                                |
| **DeferStmtSyntax**       | defer å»¶åæ‰§è¡Œ    | `DeferStmtSyntax(body: ...)`                          |



## 4. ç±»å‹ï¼ˆTypeSyntaxï¼‰

ç”¨äºè¡¨ç¤ºç±»å‹å£°æ˜ï¼ŒåŒ…æ‹¬ç®€å•ç±»å‹ã€æ•°ç»„ã€å¯é€‰ã€å…ƒç»„ã€å‡½æ•°ç±»å‹ç­‰ã€‚

| åç§°                           | æè¿°                     | å¿«é€Ÿæ„é€ ç¤ºä¾‹                                             |
| ------------------------------ | ------------------------ | -------------------------------------------------------- |
| **SimpleTypeIdentifierSyntax** | åŸºæœ¬ç±»å‹ `Int, String`   | `SimpleTypeIdentifierSyntax(name: "Int")`                |
| **OptionalTypeSyntax**         | å¯é€‰ç±»å‹ `Int?`          | `OptionalTypeSyntax(wrappedType: ...)`                   |
| **ArrayTypeSyntax**            | æ•°ç»„ç±»å‹ `[Int]`         | `ArrayTypeSyntax(elementType: ...)`                      |
| **DictionaryTypeSyntax**       | å­—å…¸ç±»å‹ `[K: V]`        | `DictionaryTypeSyntax(keyType: ..., valueType: ...)`     |
| **TupleTypeSyntax**            | å…ƒç»„ç±»å‹ `(Int, String)` | `TupleTypeSyntax(elements: [...])`                       |
| **FunctionTypeSyntax**         | å‡½æ•°ç±»å‹ `(Int) -> Bool` | `FunctionTypeSyntax(parameters: [...], returnType: ...)` |
| **AttributedTypeSyntax**       | å¸¦å±æ€§ç±»å‹ `@Sendable`   | `AttributedTypeSyntax(attributes: [...], baseType: ...)` |
| **SomeTypeSyntax**             | `some` ç±»å‹              | `SomeTypeSyntax(baseType: ...)`                          |
| **MetatypeTypeSyntax**         | `.Type` `.Protocol`      | `MetatypeTypeSyntax(baseType: ..., typeOrProtocol: ...)` |
| **ExistentialTypeSyntax**      | `any` åè®®ç±»å‹           | `ExistentialTypeSyntax(type: ...)`                       |



## 5. æ¨¡å¼ï¼ˆPatternSyntaxï¼‰

ç”¨äº `let/var` ç»‘å®šã€æ¨¡å¼åŒ¹é…ç­‰ç»“æ„ã€‚

| åç§°                          | æè¿°         | å¿«é€Ÿæ„é€ ç¤ºä¾‹                                                 |
| ----------------------------- | ------------ | ------------------------------------------------------------ |
| **IdentifierPatternSyntax**   | æ ‡è¯†ç¬¦æ¨¡å¼   | `IdentifierPatternSyntax(identifier: .identifier("name"))`   |
| **TuplePatternSyntax**        | å…ƒç»„æ¨¡å¼     | `TuplePatternSyntax(elements: [...])`                        |
| **WildcardPatternSyntax**     | é€šé…ç¬¦ `_`   | `WildcardPatternSyntax()`                                    |
| **ValueBindingPatternSyntax** | let/var æ¨¡å¼ | `ValueBindingPatternSyntax(bindingSpecifier: "let", pattern: ...)` |
| **ExpressionPatternSyntax**   | è¡¨è¾¾å¼åŒ¹é…   | `ExpressionPatternSyntax(expression: ...)`                   |



## 6. å±æ€§ï¼ˆAttributeSyntaxï¼‰

ç”¨äºä¿®é¥°å£°æ˜ï¼ŒåŒ…æ‹¬æ ‡å‡†å±æ€§å’Œè‡ªå®šä¹‰å±æ€§åŒ…è£…å™¨ã€‚

| åç§°                      | æè¿°       | å¿«é€Ÿæ„é€ ç¤ºä¾‹                                        |
| ------------------------- | ---------- | --------------------------------------------------- |
| **AttributeSyntax**       | æ ‡å‡†å±æ€§   | `AttributeSyntax(attributeName: "available")`       |
| **CustomAttributeSyntax** | è‡ªå®šä¹‰å±æ€§ | `CustomAttributeSyntax(attributeName: "MyWrapper")` |



## 7. å®ï¼ˆMacroExpansionSyntaxï¼‰

ä¸“é—¨ç”¨äºè¡¨ç¤ºå®çš„ä½¿ç”¨ä¸å±•å¼€ã€‚

| åç§°                                 | æè¿°                         | å¿«é€Ÿæ„é€ ç¤ºä¾‹                                                 |
| ------------------------------------ | ---------------------------- | ------------------------------------------------------------ |
| **FreestandingMacroExpansionSyntax** | è¡¨è¾¾å¼ç‹¬ç«‹å® `#stringify(x)` | `FreestandingMacroExpansionSyntax(macroName: "stringify", arguments: [...])` |
| **AttributeMacroExpansionSyntax**    | å±æ€§å® `@MyMacro`            | `AttributeMacroExpansionSyntax(macroName: "MyMacro", arguments: [...])` |
| **AccessorMacroExpansionSyntax**     | Accessor å®ï¼ˆgetter/setterï¼‰ | `AccessorMacroExpansionSyntax(macroName: "MyAccessor")`      |



## 8. å…¶ä»–å¸¸ç”¨èŠ‚ç‚¹

| åç§°                           | æè¿°                          | å¿«é€Ÿæ„é€ ç¤ºä¾‹                                  |
| ------------------------------ | ----------------------------- | --------------------------------------------- |
| **CodeBlockSyntax**            | ä¸€ç»„è¯­å¥å— `{ ... }`          | `CodeBlockSyntax(statements: [...])`          |
| **MemberDeclListSyntax**       | æˆå‘˜å£°æ˜åˆ—è¡¨                  | `MemberDeclListSyntax(members: [...])`        |
| **ParameterClauseSyntax**      | å‚æ•°ç­¾å `(x: Int)`           | `ParameterClauseSyntax(parameters: [...])`    |
| **TupleExprElementListSyntax** | å…ƒç»„è¡¨è¾¾å¼å…ƒç´ åˆ—è¡¨            | `TupleExprElementListSyntax(elements: [...])` |
| **TokenSyntax**                | åŸºç¡€ Tokenï¼Œå¦‚æ ‡è¯†ç¬¦/å…³é”®å­—ç­‰ | `.identifier("foo")`, `.keyword(.func)`       |
| **SourceFileSyntax**           | æ•´ä¸ª Swift æºæ–‡ä»¶è¯­æ³•ç»“æ„     | `SourceFileSyntax(statements: [...])`         |



å¦‚æœä½ æƒ³æ·»åŠ æ›´å¤šèŠ‚ç‚¹ï¼Œæ¬¢è¿ PR æˆ–ç•™è¨€è¡¥å……ï¼ä½ ä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹å†™ä¸Šæ›´å¤šã€Œæ„é€ æŠ€å·§ã€ã€ã€Œè¯­ä¹‰é™åˆ¶ã€ä¸ã€Œå¸¸è§é”™è¯¯ã€ï¼Œè®©è¿™ä¸ªè¡¨å˜å¾—æ›´å®ç”¨ ğŸ‘



## æ¥æº

ä¸ºäº†ç¡®ä¿å†…å®¹çš„å‡†ç¡®æ€§å’Œæ—¶æ•ˆæ€§ï¼Œæ¬¢è¿æ‚¨å®šæœŸå‚è€ƒå®˜æ–¹æ–‡æ¡£å’Œèµ„æºï¼š

[swift-syntaxæºç ](https://github.com/swiftlang/swift-syntax)

[SwiftSyntaxæ–‡æ¡£](https://swiftpackageindex.com/swiftlang/swift-syntax/601.0.0/documentation/swiftsyntax?utm_source=chatgpt.com)

å¦‚æœ‰æ›´æ–°ï¼Œæäº¤MRï¼Œä¸€èµ·ç»´æŠ¤å®ƒã€‚
